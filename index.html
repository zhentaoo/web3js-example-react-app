<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Polygon Drawing</title>
    <link href="https://vjs.zencdn.net/7.19.2/video-js.css" rel="stylesheet">
    <script src="https://vjs.zencdn.net/7.19.2/video.min.js"></script>
    
</head>
<style>
    #video-container {
        position: relative;
        width: 640px;
        height: 360px;
    }
    .video-js {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    .overlay-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none; /* Allow clicks to pass through the canvas to the video controls */
    }
    .vjs-control-bar {
        z-index: 1;
    }

    #video > div.vjs-control-bar > button.vjs-fullscreen-control.vjs-control.vjs-button {
        display: none;
    }
    #my-video > div.vjs-control-bar > button.vjs-fullscreen-control.vjs-control.vjs-button {
        display: none;
    }
</style>
<body>
    <div id="video-container">
        <video 
         id="my-video" 
         width="640"
         height="360" 
         
         class="video-js"
         controls
         preload="auto"
         data-setup="{}"
         >
            <source src="./200.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <canvas
         class="overlay-canvas"
         id="canvas" width="640" height="360"></canvas>
    </div>


    <script>
        const player = videojs('my-video', {
            controlBar: {
                fullscreenToggle: false // Disable fullscreen button
            }
        });
        
        player.ready(function() {
            player.tech_.off('dblclick');
            const video = document.querySelector('#my-video_html5_api');
            const canvas = document.querySelector('.overlay-canvas');
            const ctx = canvas.getContext('2d');

            const drawPolygon = () => {
                if (!video.paused && !video.ended) {
                // if (!video.ended) {
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    // 设置多边形的顶点坐标
                    const points = [
                        { x: 100, y: 100 },
                        { x: 200, y: 50 },
                        { x: 300, y: 100 },
                        { x: 350, y: 200 },
                        { x: 250*Math.random(), y:300*Math.random() },
                        { x: 100*Math.random(), y:200*Math.random() }
                    ];

                    // 绘制多边形
                    ctx.beginPath();
                    ctx.moveTo(points[0].x, points[0].y);
                    for (let i = 1; i < points.length; i++) {
                        ctx.lineTo(points[i].x, points[i].y);
                    }
                    ctx.closePath();
                    ctx.strokeStyle = 'cyan';
                    ctx.lineWidth = 11;
                    ctx.stroke();

                    requestAnimationFrame(drawPolygon);
                }
            };

            const drawPolygon2 = () => {
                // if (!video.paused && !video.ended) {
                // if (!video.ended) {
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    // 设置多边形的顶点坐标
                    const points = [
                        { x: 100, y: 100 },
                        { x: 200, y: 50 },
                        { x: 300, y: 100 },
                        { x: 350, y: 200 },
                        { x: 250*Math.random(), y:300*Math.random() },
                        { x: 100*Math.random(), y:200*Math.random() }
                    ];

                    // 绘制多边形
                    ctx.beginPath();
                    ctx.moveTo(points[0].x, points[0].y);
                    for (let i = 1; i < points.length; i++) {
                        ctx.lineTo(points[i].x, points[i].y);
                    }
                    ctx.closePath();
                    ctx.strokeStyle = 'cyan';
                    ctx.lineWidth = 11;
                    ctx.stroke();

                    requestAnimationFrame(drawPolygon);
                // }
            };

            video.addEventListener('seeking', drawPolygon2);
            video.addEventListener('seeked', drawPolygon2);
            video.addEventListener('play', drawPolygon);

        });




    
    </script>
</body>
</html>
